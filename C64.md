# Commodores 64

## Especificaciones

| Elemento | Descripción |
|:--------:|-------------|
| CPU | MOS Technology 6510 <br/> - PAL: 0.9852486 MHz <br/> - NTSC: 1.0227273 MHz |
| RAM | 64 KB |
| ROM | 20 KB dividido en 3 chips <br/> - 8 KB BASIC V2 (\$A000-\$BFFF) <br/> - 8 KB KERNAL (\$E000-\$FFFF) <br/> - 4 KB FONTS (\$D000-\$DFFF) |
| Gráficos | VIC-II (MOS 6567/6569) <br/> - Resolución: 320x200 <br/> - Colores: 16 <br/> - Sprites: 8 de 24x21 (2 colores) o 12x21 (4 colores) <br/> - Interrupciones del rasterizado |
| Sonido | SID (MOS 6581) <br/> - 3x Osciladores (8 octavas, 16-4000 Hz) <br/> - 4x Formas de onda (sierra, triángulo, cuadrada y ruido) <br/> - Filtros: paso-bajo (LPF), paso-alto (HPF) y paso-banda (BPF) <br/> - Envolvente (ADSR) <br/> - Modulación por anillo (Ring Modulation) |
| E/S | - 2x CIA 6526 (joystick, teclado, RS-232, GPIO) <br/> - Bus en serie IEEE 488 (disqueteras e impresoras) <br/> - Cintas de casete (datasette) <br/> - Cartuchos de ROM |
| Disco | Commodore 1541 (5¼ SS-SD, 170 KB) |

## Lenguaje BASIC

### Hola mundo

Para empezar recurriremos al clásico Hola Mundo:

```BASIC
10 REM ESTO ES UN COMENTARIO
20 PRINT "HOLA MUNDO"
```

Todo programa en BASIC está compuesto por líneas con comandos. Cada línea empieza por un número identificador, de 0 a 63999, seguido de un comando del lenguaje. Las líneas tendrán un tamaño máximo de 80 caracteres. Opcionalmente podremos usar `:` para tener varios comandos dentro de una misma línea.

En el ejemplo tenemos dos líneas como parte del programa. En la primera tenemos un comentario de código usando el comando `REM`. En la segunda, con el comando `PRINT`, se envía un mensaje de texto a la pantalla. Para poder ejecutar el programa usaremos el comando `RUN`.

La C64 nos permite ver el código del programa cargado en memoria con `LIST`. 

$$
\texttt{LIST}\ \textcolor{red}{[[} \mathit{primera} \textcolor{red}{]} \texttt{-} \textcolor{red}{[} \mathit{última} \textcolor{red}{]]}
$$

| Parámetro | Descripción |
|:---------:|-------------|
| *primera* | Número de línea inicial del listado, por defecto es 0. |
| *última* | Número de línea final del listado, por defecto es 63999. |

Por ejemplo:

```BASIC
LIST 10     : REM Lista la línea 10 del programa.
LIST -10    : REM Lista hasta la línea 10 del programa.
LIST 10-    : REM Lista desde la línea 10 del programa.
LIST 10-100 : REM Lista desde la línea 10 hasta a la 100.
```

### Comentarios

Con el comando `REM` podemos comentar el código para documentarlo, pero estos comentarios ocupan espacio en la memoria de programa. Este comando ignora el uso de `:` para añadir varios comandos en la misma línea, ya que será ignorado todo lo que venga después de `REM` en la línea.

### Constantes

BASIC tiene tres tipos de datos: **números enteros**, **números flotantes** y **cadenas de texto**. Los tres los podemos expresar como valores literales de la siguiente manera:

- **Enteros:** Números de 16 bits con signo (2 Bytes). Desde `-32768` hasta `+32767`, usando [complemento a dos](https://es.wikipedia.org/wiki/Complemento_a_dos), usando la siguiente sintaxis:

$$\textcolor{red}{[}\texttt{+}\textcolor{red}{|}\texttt{-}\textcolor{red}{]} \mathit{d\acute{\imath}gitos}$$ 

- **Flotantes:** Números flotantes de 40 bits (5 Bytes). El exponente puede tener un valor desde `-39` hasta `+38`. Usan la siguiente sintaxis:

$$\textcolor{red}{[}\texttt{+}\textcolor{red}{|}\texttt{-}\textcolor{red}{]} \mathit{d\acute{\imath}gitos}\textcolor{red}{[}\texttt{.}\mathit{d\acute{\imath}gitos}\textcolor{red}{]} \textcolor{red}{[}\texttt{E}\textcolor{red}{[}\texttt{+}\textcolor{red}{|}\texttt{-}\textcolor{red}{]} \mathit{d\acute{\imath}gitos}\textcolor{red}{]}$$

- **Cadenas:** Cualquier texto que empieza y termina por dobles comillas (`"`).

Por ejemplo:

```BASIC
10 PRINT "CADENA DE TEXTO"     : REM CADENA DE TEXTO
20 PRINT "POSITIVO:"  1234     : REM POSITIVO: 1234     
30 PRINT "NEGATIVO:" -4321     : REM NEGATIVO:-4321
40 PRINT "FLOTANTE:" 6.543E-21 : REM FLOTANTE: 6.543E-21
```

El único carácter que no puede contener un literal de cadena de texto son las dobles comillas, sin embargo usando la función `CHR$(34)` podemos obtener una cadena de texto que contenga dobles comillas:
 
```BASIC
10 PRINT CHR$(34) "AMIGA" CHR$(34) : REM "AMIGA"
```

Por último, la constante **pi** está representada por la letra griega `π`, que se escribe con las teclas `MAYÚS`+`AvPág` en VICE y con `MAYÚS`+`SUPR` en CCS64.

```BASIC
10 PRINT π : REM 3.14159265
```

### Variables

Las variables nos permiten guardar valores con un nombre identificador, para poder recuperarlos y/o modificarlos más tarde. Un nombre identificador es una secuencia compuesta por letras (`A-Z`) y dígitos (`0-9`), que debe empezar siempre por una letra. Los tipos de variables que existen son:

- **Flotantes:** Almacenan números de coma flotante. Es el tipo por defecto de las variables, simplemente hay que definir un nombre identificador. Por ejemplo: `X`, `Y`, `Z`, etc.
- **Enteras:** Almacenan números enteros. Este tipo se asigna terminando el nombre identificador con el símbolo `%`. Por ejemplo: `I%`, `J%`, `K%`, etc.
- **Cadenas:** Almacenan cadenas de texto. Este tipo se asigna terminando el nombre identificador con el símbolo `$`. Por ejemplo: `N$`, `M$`, `S$`, etc.

Podemos asignar un valor a una variable con el operador `=`:

```BASIC
10 U  = 1.234
20 V% = 12345
30 W$ = "ABC"
```

El tamaño de un nombre identificador puede ser tan largo como una línea, pero el intérprete de BASIC sólo tiene en cuenta las dos primeras letras y su tipo. Es decir:

```BASIC
10 RAX  = 10
20 RAY  = 20
30 RAZ% = 30
40 PRINT RAX  : REM 20
50 PRINT RAZ% : REM 30
```

No podremos utilizar como nombres identificadores los que ya están asignados para los comandos de BASIC, así como sus abreviaciones, a las que llamaremos palabras reservadas del lenguaje.

### Operadores

El lenguaje dispone de diferentes operaciones para poder trabajar con los valores. A la hora de aplicar un operador, este tiene un nivel de prioridad que veremos al final de la sección. La primera categoría de operadores son los aritméticos:

| Símbolo | Descripción              |
|:-------:|--------------------------|
| `+`     | Suma / Prefijo positivo  |
| `-`     | Resta / Prefijo negativo |
| `*`     | Multiplicación           |
| `/`     | División                 |
| `↑`     | Exponenciación           |

El símbolo `↑` se escribe con la tecla `AvPág` en VICE y con `SUPR` en CCS64. Estas operaciones aritméticas se pueden utilizar con números enteros y reales. Por ejemplo:

```BASIC
10 A = 3 : B = 2
20 PRINT A + -B      : REM 1
30 PRINT A - B       : REM 1
40 PRINT A * B       : REM 6
50 PRINT A / B       : REM 1.5
60 PRINT A ↑ B       : REM 9
70 PRINT A + B / 2   : REM 4
80 PRINT (A + B) / 2 : REM 2.5
```

Nótese que con los paréntesis podemos alterar el orden de aplicación de los operadores, porque los paréntesis también son operadores en sí mismos.

El siguiente grupo de operadores son los de comparación:

| Símbolo | Descripción   |
|:-------:|---------------|
| `<`     | Menor         |
| `<=`    | Menor o igual |
| `=`     | Igual         |
| `>=`    | Mayor o igual |
| `>`     | Mayor         |
| `<>`    | Distinto      |

Podemos usar estos operadores con cualquier valor, para determinar qué orden tienen entre sí. Vemos que el símbolo `=` es usado por los operadores de igualdad y de asignación, pero sólo hay dos situaciones donde se usa la asignación:

```BASIC
10 A = 1
20 LET B = 2
30 PRINT A = B
```

Hemos dicho dos situaciones, pero en realidad es sólo una. En la línea `20` usamos el comando `LET`, que nos permite asignar a una variable (situada a la izquierda del `=`) un valor obtenido con una expresión (situada a la derecha del `=`). En la línea `10` en realidad estamos también usando el comando `LET`, pero podemos prescindir de la palabra clave `LET` para asignar un valor a una variable.

El siguiente grupo de operadores son los lógicos:

| Símbolo | Descripción   |
|:-------:|---------------|
| `NOT`   | Negación      |
| `AND`   | Conjunción    |
| `OR`    | Disyunción    |

Antes de continuar, necesitamos una pequeña explicación teórica:

> Los operadores de comparación, junto a los operadores lógicos, permiten crear **expresiones booleanas** que representan condiciones dentro de los programas, para poder tomar decisiones durante la ejecución. El resultado de una expresión booleana es un **valor booleano**, pero al no existir este tipo de dato en BASIC se utilizan los números enteros, usando `0` para indicar que la condición es **falsa** y cualquier otro valor entero para indicar que es **verdadera** (por ejemplo, cuando una comparación es verdadera se obtiene como resultado el `-1`).

Para entender mejor los operadores lógicos vamos a ver sus *tablas de verdad*:

| `A` | `B` | `NOT A` | `NOT B` | `A AND B` | `A OR B` |
|:---:|:---:|:-------:|:-------:|:---------:|:--------:|
|  V  |  V  |    F    |    F    |     V     |    V     |
|  F  |  V  |    V    |    F    |     F     |    V     |
|  V  |  F  |    F    |    V    |     F     |    V     |
|  F  |  F  |    V    |    V    |     F     |    F     |

Estos operadores lógicos funcionan a [nivel de bits](https://es.wikipedia.org/wiki/Operador_a_nivel_de_bits), es decir, se aplican a cada bit de los 16 que hay en un número entero de BASIC. Por lo tanto, si hacemos `2 OR 1` el resultado será `3`. Si intentamos usar un número real, con un operador lógico, el valor será transformado a un valor entero, para poder operar con él.

Finalmente, tenemos el grupo de operadores para manejar cadenas, que está compuesto únicamente por la concatenación, que utiliza el símbolo `+`. Por ejemplo:

```BASIC
10 A$ = "HOLA"
20 B$ = " MUNDO"
30 PRINT A$ + B$ : REM HOLA MUNDO
```

Por último, vamos a ver la prioridad de cada operador a la hora de ser aplicados en una expresión:
| Nivel | Operadores | Descripción |
|:-----:|:----------:|-------------|
| 1 | `↑` | Exponenciación |
| 2 | `+`<br/>`-` | Prefijos |
| 3 | `*`<br/>`/` | Multiplicación<br/>División |
| 4 | `+`<br/>`-` | Suma/Concatenación<br/>Resta |
| 5 | `<`<br/>`<=`<br/>`=`<br/>`>=`<br/>`>`<br/>`<>` | Comparación |
| 6 | `NOT` | Negación |
| 7 | `AND` | Conjunción |
| 8 | `OR` | Disyunción |

### Arrays

Los arrays son "tablas" de una o más dimensiones donde cada celda contiene un valor. En BASIC se utilizan los paréntesis, a la derecha de un nombre de variable con su tipo, para asignar o acceder a los valores que hay dentro. Por ejemplo:

```BASIC
10 A$(0) = "HOLA"
20 A$(1) = "MUNDO"
30 PRINT A$(0) " " A$(1) : REM HOLA MUNDO
```

..

### Entrada y salida

..

### Funciones

..

### Comandos

..

### Abreviaturas

| Com.   | Abr.  | Com.   | Abr.  | Com.    | Abr.  | Com.   | Abr.  |
|:------:|:-----:|:------:|:-----:|:-------:|:-----:|:------:|:-----:|
| ABS    |A, ⇧+B | AND    |A, ⇧+N | ASC     |A, ⇧+S | ATN    |A, ⇧+T |
| CHR$   |C, ⇧+H | CLOSE  |CL, ⇧+O| CLR     |C, ⇧+L | CMD    |C, ⇧+M |
| CONT   |C, ⇧+O | COS    |       | DATA    |D, ⇧+A | DEF    |D, ⇧+E |
| DIM    |D, ⇧+I | END    |E, ⇧+N | EXP     |E, ⇧+X | FN     |       |
| FOR    |F, ⇧+O | FRE    |F, ⇧+R | GET     |G, ⇧+E | GET#   |       |
| GOSUB  |GO, ⇧+S| GOTO   |G, ⇧+O | IF      |       | INPUT  |       |
| INPUT# |I, ⇧+N | INT    |       | LEFT$   |LE, ⇧+F| LEN    |       |
| LET    |L, ⇧+E | LIST   |L, ⇧+I | LOAD    |L, ⇧+O | LOG    |       |
| MID$   |M, ⇧+I | NEW    |       | NEXT    |N, ⇧+E | NOT    |N, ⇧+O |
| ON     |       | OPEN   |O, ⇧+P | OR      |       | PEEK   |P, ⇧+E |
| POKE   |P, ⇧+O | POS    |       | PRINT   |?      | PRINT# |PR     |
| READ   |R, ⇧+E | REM    |       | RESTORE |RE, ⇧+S| RETURN |RE, ⇧+T|
| RIGHT$ |R, ⇧+I | RND    |R, ⇧+N | RUN     |R, ⇧+U | SAVE   |S, ⇧+A |
| SGN    |S, ⇧+G | SIN    |S, ⇧+I | SPC     |S, ⇧+P | SQR    |S, ⇧+Q |
| STATUS |ST     | STEP   |ST, ⇧+E| STOP    |S, ⇧+T | STR$   |ST, ⇧+R|
| SYS    |S, ⇧+Y | TAB    |T, ⇧+A | TAN     |       | THEN   |T, ⇧+H |
| TIME   |TI     | TIME$  |TI$    | TO      |       | USR    |U, ⇧+S |
| VAL    |V, ⇧+A | VERIFY |V, ⇧+E | WAIT    |W, ⇧+A |        |       |

## Lenguaje ensamblador

..

## Interfaz gráfica

..

## Interfaz sonora

..

## Entrada y salida

### Teclado

..

### Joysticks

..

## Mapa de memoria

..
